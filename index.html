<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Double vue (iframes)</title>
    <style>
        :root{
            --bg:#f6f7fb;
            --fg:#111;
            --bar:#ffffff;
            --muted:#666;
            --accent:#0b76ef;
            --height-bar:56px;
        }
        [data-theme="dark"]{
            --bg:#0b0f14;
            --fg:#e6eef8;
            --bar:#081018;
            --muted:#9fb3d0;
            --accent:#3ea0ff;
        }

        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--fg);background:var(--bg);}

        .toolbar{
            height:var(--height-bar);
            width:100%;
            background:var(--bar);
            display:flex;
            align-items:center;
            gap:12px;
            padding:8px 12px;
            position:fixed;
            top:0;
            left:0;
            z-index:30;
            border-bottom:1px solid rgba(0,0,0,0.06);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            background:rgba(255,255,255,0.8);
        }
        .toolbar .group{display:flex;align-items:center;gap:8px}
        .toolbar label{font-size:15px;color:var(--muted);font-weight:500}
        .toolbar button, .toolbar select{
            background:transparent;
            border:1px solid rgba(0,0,0,0.08);
            padding:10px 16px;
            border-radius:8px;
            color:var(--fg);
            cursor:pointer;
            font-size:15px;
            min-height:44px;
            min-width:44px;
            -webkit-tap-highlight-color:transparent;
            touch-action:manipulation;
        }
        .toolbar button.active{
            background:var(--accent);
            color:#fff;
            border-color:transparent;
        }

        .main{
            height:calc(100vh - var(--height-bar));
            margin-top:var(--height-bar);
            display:flex;
            gap:6px;
            padding:0;
        }
        .main.row{flex-direction:row}
        .main.column{flex-direction:column}

        .pane{
            flex:1 1 50%;
            min-height:0; /* allow iframe to shrink properly */
            display:block;
            background:#000;
            border:0;
        }
        iframe{
            width:100%;
            height:100%;
            border:0;
            display:block;
            background:#fff;
        }

        /* iPad and tablet optimizations */
        @media (max-width:1024px){
            :root{ --height-bar:64px; }
            .toolbar{
                padding:12px;
                gap:16px;
            }
            .toolbar button{
                padding:12px 18px;
                font-size:16px;
            }
            .toolbar label{
                font-size:16px;
            }
        }

        /* Force column layout on portrait tablets/phones */
        @media (max-width:920px), (orientation:portrait){
            .main{
                flex-direction:column;
            }
            .pane{
                flex:1 1 50%;
                min-height:40vh;
            }
            #sideBtn, #stackBtn{
                display:none;
            }
        }

        /* Prevent overscroll on iOS */
        @supports (-webkit-touch-callout:none){
            html,body{
                position:fixed;
                overflow:hidden;
                width:100%;
                height:100%;
                overscroll-behavior:none;
                -webkit-overflow-scrolling:touch;
            }
            .main{
                position:fixed;
                top:var(--height-bar);
                left:0;
                right:0;
                bottom:0;
                margin:0;
                height:auto;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="toolbar" role="toolbar" aria-label="Options">
        <div class="group" style="margin-right:12px;">
            <label style="margin-right:6px">Thème</label>
            <button id="themeToggle" title="Basculer thème sombre / clair">Mode sombre</button>
        </div>

        <div class="group">
            <label style="margin-right:6px">Disposition</label>
            <button id="sideBtn" class="active" title="Afficher côte à côte">Côte à côte</button>
            <button id="stackBtn" title="Afficher l'un au dessus de l'autre">Empilés</button>
        </div>

        <div style="flex:1"></div>

        <div class="group">
            <label style="margin-right:6px">Sélection droite</label>
            <button id="rkcBtn" title="Charger RKC">RKC</button>
            <button id="kartBtn" title="Charger Kartland">Kartland</button>
        </div>
    </div>

    <div id="main" class="main row" aria-live="polite">
        <div class="pane" id="leftPane">
            <iframe id="leftIframe" src="https://www.lameteoagricole.net/meteo-heure-par-heure/Cormeilles-en-Vexin-95830.html" title="Météo" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
        </div>
        <div class="pane" id="rightPane">
            <iframe id="rightIframe" src="https://live.apex-timing.com/rkc/" title="Droite : site 2" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
        </div>
    </div>

    <script>
        // Elements
        const themeToggle = document.getElementById('themeToggle');
        const sideBtn = document.getElementById('sideBtn');
        const stackBtn = document.getElementById('stackBtn');
        const rkcBtn = document.getElementById('rkcBtn');
        const kartBtn = document.getElementById('kartBtn');
    const body = document.body;
    const main = document.getElementById('main');
    const rightIframe = document.getElementById('rightIframe');
        const leftIframe = document.getElementById('leftIframe');        // URLs
        const URL_RKC = 'https://live.apex-timing.com/rkc/';
        const URL_KART = 'https://www.apex-timing.com/live-timing/kartland/';
        const URL_WEATHER_RKC = 'https://www.lameteoagricole.net/meteo-heure-par-heure/Cormeilles-en-Vexin-95830.html';
        const URL_WEATHER_KART = 'https://www.lameteoagricole.net/meteo-heure-par-heure/Moissy-Cramayel-77550.html';

        // Theme: toggle between light/dark with button text update
        function setTheme(theme){
            body.setAttribute('data-theme', theme);
            themeToggle.textContent = theme === 'dark' ? 'Mode clair' : 'Mode sombre';
            // remember
            localStorage.setItem('dualview-theme', theme);
        }
        themeToggle.addEventListener('click', ()=> setTheme(body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));
        // restore
        const savedTheme = localStorage.getItem('dualview-theme');
        if(savedTheme) setTheme(savedTheme);

        // Layout toggles
        function setLayout(mode){
            if(mode === 'row'){
                main.classList.remove('column');
                main.classList.add('row');
                sideBtn.classList.add('active');
                stackBtn.classList.remove('active');
            } else {
                main.classList.remove('row');
                main.classList.add('column');
                stackBtn.classList.add('active');
                sideBtn.classList.remove('active');
            }
            localStorage.setItem('dualview-layout', mode);
        }
        sideBtn.addEventListener('click', ()=> setLayout('row'));
        stackBtn.addEventListener('click', ()=> setLayout('column'));
        const savedLayout = localStorage.getItem('dualview-layout') || (window.innerWidth <= 720 ? 'column' : 'row');
        setLayout(savedLayout);

        // Right iframe selection
        function setRight(url){
            try{
                rightIframe.src = url;
            }catch(e){}
            // mark active
            rkcBtn.classList.toggle('active', url === URL_RKC);
            kartBtn.classList.toggle('active', url === URL_KART);
            localStorage.setItem('dualview-right', url);
        }
        // Load both left weather and right timing when buttons clicked
        rkcBtn.addEventListener('click', ()=> {
            setRight(URL_RKC);
            leftIframe.src = URL_WEATHER_RKC;
            localStorage.setItem('dualview-left', URL_WEATHER_RKC);
        });
        kartBtn.addEventListener('click', ()=> {
            setRight(URL_KART);
            leftIframe.src = URL_WEATHER_KART;
            localStorage.setItem('dualview-left', URL_WEATHER_KART);
        });
        // restore last right
        const savedRight = localStorage.getItem('dualview-right') || URL_RKC;
        setRight(savedRight);

        // restore last left if any
        const savedLeft = localStorage.getItem('dualview-left');
        if(savedLeft && leftIframe){ leftIframe.src = savedLeft; }

        // Optional: allow user to swap panes by double-tapping toolbar area (quick swap)
        let lastTap = 0;
        document.querySelector('.toolbar').addEventListener('touchend', (e)=>{
            const now = Date.now();
            if(now - lastTap < 300){ // Double tap detected
                const left = document.getElementById('leftIframe').src;
                const right = rightIframe.src;
                document.getElementById('leftIframe').src = right;
                rightIframe.src = left;
                e.preventDefault();
            }
            lastTap = now;
        });
        // Keep double-click for desktop
        document.querySelector('.toolbar').addEventListener('dblclick', ()=>{
            const left = document.getElementById('leftIframe').src;
            const right = rightIframe.src;
            document.getElementById('leftIframe').src = right;
            rightIframe.src = left;
        });

        // Prevent unwanted iOS behaviors
        document.addEventListener('gesturestart', (e)=>e.preventDefault()); // Prevent pinch zoom
        document.addEventListener('touchmove', (e)=>e.preventDefault(), {passive:false}); // Prevent overscroll

        // Auto-switch to column in portrait, row in landscape (iPads)
        window.addEventListener('orientationchange', ()=>{
            setTimeout(()=>{ // Small delay to let orientation complete
                if(window.innerWidth <= 920 || window.orientation === 0){ // portrait
                    setLayout('column');
                } else { // landscape
                    setLayout('row');
                }
            }, 50);
        });

        // Note: some external sites may block being loaded in an iframe (X-Frame-Options).
        // If a site refuses to load, the iframe will remain blank or show an error.
    </script>
</body>
</html>